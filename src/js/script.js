// ĞŸĞµÑ€ĞµĞºĞ»Ğ°Ğ´Ğ¸
const translations = {
  uk: {
    title: "Ğ— Ğ”Ğ½ĞµĞ¼ Ğ—Ğ°ĞºĞ¾Ñ…Ğ°Ğ½Ğ¸Ñ… â¤ï¸",
    subtitle: "Ğ”Ğ»Ñ Ğ½Ğ°Ğ¹Ğ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ñ–ÑˆĞ¾Ñ— Ğ»ÑĞ´Ğ¸Ğ½Ğ¸ Ğ² Ğ¼Ğ¾Ñ”Ğ¼Ñƒ Ğ¶Ğ¸Ñ‚Ñ‚Ñ–",
    loveBtn: "ĞĞ°Ñ‚Ğ¸ÑĞ½Ğ¸, ÑĞºÑ‰Ğ¾ ĞºĞ¾Ñ…Ğ°Ñ”Ñˆ ğŸ’•",
    runawayBtn: "ĞĞµ ĞºĞ¾Ñ…Ğ°Ñ",
    message1:
      "ĞšĞ¾Ñ…Ğ°Ğ½Ğ½Ñ â€” Ñ†Ğµ ĞºĞ¾Ğ»Ğ¸ ĞºĞ¾Ğ¶ĞµĞ½ Ğ´ĞµĞ½ÑŒ Ğ· Ñ‚Ğ¾Ğ±Ğ¾Ñ ÑÑ‚Ğ°Ñ” ÑĞ²ÑÑ‚Ğ¾Ğ¼.<br />Ğ”ÑĞºÑƒÑ Ğ·Ğ° Ñ‚Ğ²Ğ¾Ñ ÑƒÑĞ¼Ñ–ÑˆĞºÑƒ, Ñ‚ĞµĞ¿Ğ»Ğ¾ Ñ– Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºÑƒ.<br />Ğ¯ Ğ±ĞµĞ·Ğ¼ĞµĞ¶Ğ½Ğ¾ Ñ‰Ğ°ÑĞ»Ğ¸Ğ²Ğ¸Ğ¹(Ğ°), Ñ‰Ğ¾ Ñ‚Ğ¸ Ñ” Ğ² Ğ¼Ğ¾Ñ”Ğ¼Ñƒ Ğ¶Ğ¸Ñ‚Ñ‚Ñ–.",
    message2:
      "ĞĞµÑ…Ğ°Ğ¹ Ñ†ĞµĞ¹ Ğ”ĞµĞ½ÑŒ Ğ—Ğ°ĞºĞ¾Ñ…Ğ°Ğ½Ğ¸Ñ… ÑÑ‚Ğ°Ğ½Ğµ Ñ‰Ğµ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¸Ğ¼ ÑĞ¿Ğ¾Ğ³Ğ°Ğ´Ğ¾Ğ¼ Ğ´Ğ»Ñ Ğ½Ğ°Ñ ğŸ’•",
    footer: "Ğ— Ğ»ÑĞ±Ğ¾Ğ²'Ñ ğŸ’Œ | 14 Ğ»ÑÑ‚Ğ¾Ğ³Ğ¾",
    slides: [
      "Ğ¢Ğ¸ - Ğ¼Ğ¾Ñ” ÑĞ¾Ğ½Ñ†Ğµ Ñƒ Ğ¿Ğ¾Ñ…Ğ¼ÑƒÑ€Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ â˜€ï¸",
      "ĞšĞ¾Ğ¶Ğ½Ğ° Ğ¼Ğ¸Ñ‚ÑŒ Ğ· Ñ‚Ğ¾Ğ±Ğ¾Ñ - Ñ†Ğµ Ğ¼Ğ°Ğ³Ñ–Ñ âœ¨",
      "Ğ¢Ğ¸ Ñ€Ğ¾Ğ±Ğ¸Ñˆ Ğ¼Ğ¾Ñ” Ğ¶Ğ¸Ñ‚Ñ‚Ñ ÑÑĞºÑ€Ğ°Ğ²Ñ–ÑˆĞ¸Ğ¼ ğŸŒˆ",
      "Ğ— Ñ‚Ğ¾Ğ±Ğ¾Ñ Ñ Ğ¿Ğ¾-ÑĞ¿Ñ€Ğ°Ğ²Ğ¶Ğ½ÑŒĞ¾Ğ¼Ñƒ Ñ‰Ğ°ÑĞ»Ğ¸Ğ²Ğ¸Ğ¹(Ğ°) ğŸ’•",
      "Ğ”ÑĞºÑƒÑ, Ñ‰Ğ¾ Ñ‚Ğ¸ Ñ” Ğ² Ğ¼Ğ¾Ñ”Ğ¼Ñƒ Ğ¶Ğ¸Ñ‚Ñ‚Ñ–! â¤ï¸",
    ],
    funnyTexts: [
      "Ğ“ĞµĞ¹, Ğ½Ğµ Ğ»Ğ¾Ğ²Ğ¸ Ğ¼ĞµĞ½Ğµ! ğŸƒ",
      "Ğ¢Ğ¸ ÑĞµÑ€Ğ¹Ğ¾Ğ·Ğ½Ğ¾? ğŸ˜…",
      "ĞÑƒ Ñ‚Ğ¸ Ğ¹ Ğ½Ğ°Ğ¿Ğ¾Ğ»ĞµĞ³Ğ»Ğ¸Ğ²Ğ°! ğŸ˜„",
      "Ğ¡Ñ‚Ñ–Ğ¹, ÑÑ‚Ñ–Ğ¹! ğŸ¤ª",
      "Ğ¯ ÑˆĞ²Ğ¸Ğ´ÑˆĞ¸Ğ¹! âš¡",
      "ĞœĞ°Ğ¹Ğ¶Ğµ Ğ·Ğ»Ğ¾Ğ²Ğ¸Ğ»Ğ°! ğŸ˜œ",
      "Ğ©Ğµ Ñ‚Ñ€Ğ¾Ñ…Ğ¸ ÑĞ¿Ñ€Ğ¾Ğ±ÑƒĞ¹! ğŸ’¨",
      "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ–Ğ¹ Ñ€Ğ°Ğ· Ğ²Ñ‚Ñ–ĞºĞ°Ñ! ğŸ™ˆ",
      "Ğ›Ğ°Ğ´Ğ½Ğ¾-Ğ»Ğ°Ğ´Ğ½Ğ¾... ğŸ˜³",
      "Ğ—Ğ´Ğ°ÑÑÑ! ğŸ³ï¸",
    ],
    finalBtn: "Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ Ğ½Ğµ ĞºĞ¾Ñ…Ğ°Ñ”Ñˆ!",
    sadText1: "Ğ¨ĞºĞ¾Ğ´Ğ°...",
    sadText2: "Ğ¢ĞµĞ¿ĞµÑ€ Ñ‚Ğ¸ Ñ‚Ğ°Ğº Ñ– Ğ½Ğµ Ğ´Ñ–Ğ·Ğ½Ğ°Ñ”ÑˆÑÑ,",
    sadText3: 'Ñ‰Ğ¾ Ğ±ÑƒĞ»Ğ¾ Ğ±, ĞºĞ¾Ğ»Ğ¸ Ğ± Ñ‚Ğ¸ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½ÑƒĞ»Ğ° Ğ½Ğ° "ĞšĞ¾Ñ…Ğ°Ñ"',
    closeBtn: "Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸",
  },
  de: {
    title: "Alles Gute zum Valentinstag â¤ï¸",
    subtitle: "FÃ¼r die wichtigste Person in meinem Leben",
    loveBtn: "DrÃ¼ck, wenn du liebst ğŸ’•",
    runawayBtn: "Ich liebe nicht",
    message1:
      "Liebe ist, wenn jeder Tag mit dir zum Fest wird.<br />Danke fÃ¼r dein LÃ¤cheln, deine WÃ¤rme und UnterstÃ¼tzung.<br />Ich bin unendlich glÃ¼cklich, dass du in meinem Leben bist.",
    message2:
      "MÃ¶ge dieser Valentinstag eine weitere schÃ¶ne Erinnerung fÃ¼r uns werden ğŸ’•",
    footer: "Mit Liebe ğŸ’Œ | 14. Februar",
    slides: [
      "Du bist meine Sonne an trÃ¼ben Tagen â˜€ï¸",
      "Jeder Moment mit dir ist Magie âœ¨",
      "Du machst mein Leben bunter ğŸŒˆ",
      "Mit dir bin ich wirklich glÃ¼cklich ğŸ’•",
      "Danke, dass es dich in meinem Leben gibt! â¤ï¸",
    ],
    funnyTexts: [
      "Hey, fang mich nicht! ğŸƒ",
      "Ist das dein Ernst? ğŸ˜…",
      "Du bist ja hartnÃ¤ckig! ğŸ˜„",
      "Halt, halt! ğŸ¤ª",
      "Ich bin schneller! âš¡",
      "Fast erwischt! ğŸ˜œ",
      "Versuch's noch mal! ğŸ’¨",
      "Das letzte Mal, dass ich weglaufe! ğŸ™ˆ",
      "Na gut... ğŸ˜³",
      "Ich gebe auf! ğŸ³ï¸",
    ],
    finalBtn: "Ich liebe wirklich nicht!",
    sadText1: "Schade...",
    sadText2: "Jetzt wirst du nie erfahren,",
    sadText3: 'was passiert wÃ¤re, wenn du auf "Ich liebe" gedrÃ¼ckt hÃ¤ttest',
    closeBtn: "SchlieÃŸen",
  },
  en: {
    title: "Happy Valentine's Day â¤ï¸",
    subtitle: "For the most important person in my life",
    loveBtn: "Press if you love ğŸ’•",
    runawayBtn: "I don't love",
    message1:
      "Love is when every day with you becomes a celebration.<br />Thank you for your smile, warmth and support.<br />I'm infinitely happy that you're in my life.",
    message2:
      "May this Valentine's Day become another beautiful memory for us ğŸ’•",
    footer: "With love ğŸ’Œ | February 14th",
    slides: [
      "You are my sunshine on a cloudy day â˜€ï¸",
      "Every moment with you is magic âœ¨",
      "You make my life brighter ğŸŒˆ",
      "With you I'm truly happy ğŸ’•",
      "Thank you for being in my life! â¤ï¸",
    ],
    funnyTexts: [
      "Hey, don't catch me! ğŸƒ",
      "Are you serious? ğŸ˜…",
      "You're so persistent! ğŸ˜„",
      "Stop, stop! ğŸ¤ª",
      "I'm faster! âš¡",
      "Almost caught me! ğŸ˜œ",
      "Try a bit more! ğŸ’¨",
      "Last time I'm running! ğŸ™ˆ",
      "Okay, okay... ğŸ˜³",
      "I surrender! ğŸ³ï¸",
    ],
    finalBtn: "I really don't love!",
    sadText1: "Too bad...",
    sadText2: "Now you'll never know,",
    sadText3: 'what would have happened if you pressed "I love"',
    closeBtn: "Close",
  },
};

let currentLang = "uk";
let currentSlideIndex = 0;
const slides = document.querySelectorAll(".slide");
const totalSlides = slides.length;
document.getElementById("totalSlides").textContent = totalSlides;
let autoSlideInterval = null;

// Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ Ğ·Ğ¼Ñ–Ğ½Ğ¸ Ğ¼Ğ¾Ğ²Ğ¸
function changeLanguage(lang) {
  currentLang = lang;

  // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñƒ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.classList.remove("active");
  });
  event.target.classList.add("active");

  // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ğ²ĞµÑÑŒ Ñ‚ĞµĞºÑÑ‚
  const t = translations[lang];
  document.getElementById("main-title").innerHTML = t.title;
  document.getElementById("subtitle").innerHTML = t.subtitle;
  document.getElementById("love-btn-text").innerHTML = t.loveBtn;
  document.getElementById("message-text-1").innerHTML = t.message1;
  document.getElementById("message-text-2").innerHTML = t.message2;
  document.getElementById("footer-text").innerHTML = t.footer;
  document.getElementById("sad-text-1").innerHTML = t.sadText1;
  document.getElementById("sad-text-2").innerHTML = t.sadText2;
  document.getElementById("sad-text-3").innerHTML = t.sadText3;
  document.getElementById("close-btn-text").innerHTML = t.closeBtn;

  // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ¸ ÑĞ»Ğ°Ğ¹Ğ´Ñ–Ğ²
  document.querySelectorAll(".slide-text").forEach((elem, index) => {
    elem.innerHTML = t.slides[index];
  });

  // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ñ‚ĞµĞºÑÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞĞµ ĞºĞ¾Ñ…Ğ°Ñ" Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ ÑĞºÑ‰Ğ¾ Ğ²Ğ¾Ğ½Ğ° Ñ‰Ğµ Ğ½Ğµ Ğ·Ğ¼Ñ–Ğ½Ğ¸Ğ»Ğ°ÑÑ
  const runawayBtn = document.getElementById("runaway-btn");
  if (escapeCount === 0) {
    document.getElementById("runaway-btn-text").innerHTML = t.runawayBtn;
  } else if (escapeCount >= translations[currentLang].funnyTexts.length) {
    runawayBtn.textContent = t.finalBtn;
  }
}

function createHeart(inModal = false) {
  const heart = document.createElement("div");
  heart.className = inModal ? "modal-heart" : "falling-heart";
  heart.innerText = "ğŸ’—";
  heart.style.left = Math.random() * 100 + "vw";
  heart.style.animationDuration = 3 + Math.random() * 3 + "s";
  document.body.appendChild(heart);

  setTimeout(() => heart.remove(), 6000);
}

let loveInterval;

function startLove() {
  const music = document.getElementById("music");
  const modal = document.getElementById("photoModal");

  // Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ğ²Ğ°Ñ”Ğ¼Ğ¾ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğµ Ğ²Ñ–ĞºĞ½Ğ¾
  modal.style.display = "block";
  currentSlideIndex = 0;
  showSlide(currentSlideIndex);

  // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ”Ğ¼Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ¼Ğ¸ĞºĞ°Ğ½Ğ½Ñ ÑĞ»Ğ°Ğ¹Ğ´Ñ–Ğ² ĞºĞ¾Ğ¶Ğ½Ñ– 3 ÑĞµĞºÑƒĞ½Ğ´Ğ¸
  startAutoSlide();

  // ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ”Ğ¼Ğ¾ Ğ¼ÑƒĞ·Ğ¸ĞºÑƒ
  music.play().catch((error) => {
    console.log("ĞĞ²Ñ‚Ğ¾Ğ²Ñ–Ğ´Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²Ğ°Ğ½Ğ¾ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ¾Ğ¼:", error);
  });

  // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ”Ğ¼Ğ¾ ÑĞµÑ€Ñ†Ñ (Ñ‚ĞµĞ¿ĞµÑ€ Ğ²Ğ¾Ğ½Ğ¸ Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ÑŒ Ğ—Ğ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¼ Ğ²Ñ–ĞºĞ½Ğ¾Ğ¼)
  if (!loveInterval) {
    loveInterval = setInterval(() => createHeart(true), 300);
  }

  // Ğ‘Ğ»Ğ¾ĞºÑƒÑ”Ğ¼Ğ¾ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ body Ğ½Ğ° Ğ¼Ğ¾Ğ±Ñ–Ğ»ÑŒĞ½Ğ¸Ñ…
  document.body.style.overflow = "hidden";
}

function startAutoSlide() {
  if (autoSlideInterval) {
    clearInterval(autoSlideInterval);
  }

  autoSlideInterval = setInterval(() => {
    changeSlide(1);
  }, 3000);
}

function stopAutoSlide() {
  if (autoSlideInterval) {
    clearInterval(autoSlideInterval);
    autoSlideInterval = null;
  }
}

function closeModal() {
  const modal = document.getElementById("photoModal");
  const music = document.getElementById("music");

  modal.style.display = "none";

  stopAutoSlide();

  music.pause();
  if (loveInterval) {
    clearInterval(loveInterval);
    loveInterval = null;
  }

  // Ğ Ğ¾Ğ·Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ body
  document.body.style.overflow = "";
}

function closeSadModal() {
  const sadModal = document.getElementById("sadModal");
  sadModal.style.display = "none";

  // Ğ Ğ¾Ğ·Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ body
  document.body.style.overflow = "";
}

function showSlide(index) {
  slides.forEach((slide) => slide.classList.remove("active"));

  if (index >= slides.length) {
    currentSlideIndex = 0;
  } else if (index < 0) {
    currentSlideIndex = slides.length - 1;
  } else {
    currentSlideIndex = index;
  }

  slides[currentSlideIndex].classList.add("active");
  document.getElementById("currentSlide").textContent = currentSlideIndex + 1;
}

function changeSlide(direction) {
  showSlide(currentSlideIndex + direction);

  if (autoSlideInterval) {
    startAutoSlide();
  }
}

document.addEventListener("keydown", (e) => {
  const modal = document.getElementById("photoModal");
  if (modal.style.display === "block") {
    if (e.key === "ArrowLeft") changeSlide(-1);
    if (e.key === "ArrowRight") changeSlide(1);
    if (e.key === "Escape") closeModal();
  }
});

window.onclick = function (event) {
  const modal = document.getElementById("photoModal");
  const sadModal = document.getElementById("sadModal");
  if (event.target == modal) {
    closeModal();
  }
  if (event.target == sadModal) {
    closeSadModal();
  }
};

const runawayBtn = document.getElementById("runaway-btn");
const messageBlock = document.querySelector(".message");
const footerBlock = document.querySelector("footer");
let escapeCount = 0;

runawayBtn.addEventListener("mouseenter", () => {
  const funnyTexts = translations[currentLang].funnyTexts;

  if (escapeCount < funnyTexts.length) {
    runawayBtn.innerHTML = `<span id="runaway-btn-text">${funnyTexts[escapeCount]}</span>`;

    setTimeout(() => {
      const btnWidth = runawayBtn.offsetWidth;
      const btnHeight = runawayBtn.offsetHeight;
      const padding = 20;

      const messageRect = messageBlock.getBoundingClientRect();
      const footerRect = footerBlock.getBoundingClientRect();

      let newX, newY;
      let attempts = 0;
      const maxAttempts = 50;

      do {
        newX =
          Math.random() * (window.innerWidth - btnWidth - padding * 2) +
          padding;
        newY =
          Math.random() * (window.innerHeight - btnHeight - padding * 2) +
          padding;

        attempts++;

        const intersectsMessage = !(
          newX + btnWidth < messageRect.left ||
          newX > messageRect.right ||
          newY + btnHeight < messageRect.top ||
          newY > messageRect.bottom
        );

        const intersectsFooter = !(
          newX + btnWidth < footerRect.left ||
          newX > footerRect.right ||
          newY + btnHeight < footerRect.top ||
          newY > footerRect.bottom
        );

        if (!intersectsMessage && !intersectsFooter) {
          break;
        }
      } while (attempts < maxAttempts);

      runawayBtn.style.position = "absolute";
      runawayBtn.style.left = `${newX}px`;
      runawayBtn.style.top = `${newY}px`;
    }, 150);

    escapeCount++;
  } else {
    runawayBtn.textContent = translations[currentLang].finalBtn;
    runawayBtn.style.cursor = "pointer";
  }
});

runawayBtn.addEventListener("click", () => {
  if (escapeCount >= translations[currentLang].funnyTexts.length) {
    const sadModal = document.getElementById("sadModal");
    sadModal.style.display = "block";

    // Ğ‘Ğ»Ğ¾ĞºÑƒÑ”Ğ¼Ğ¾ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ body Ğ½Ğ° Ğ¼Ğ¾Ğ±Ñ–Ğ»ÑŒĞ½Ğ¸Ñ…
    document.body.style.overflow = "hidden";
  }
});

// ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ° ÑĞ²Ğ°Ğ¹Ğ¿Ñ–Ğ² Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ñ–Ğ»ÑŒĞ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸ÑÑ‚Ñ€Ğ¾Ñ—Ğ²
let touchStartX = 0;
let touchEndX = 0;

document.getElementById("photoModal").addEventListener("touchstart", (e) => {
  touchStartX = e.changedTouches[0].screenX;
});

document.getElementById("photoModal").addEventListener("touchend", (e) => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
});

function handleSwipe() {
  if (touchEndX < touchStartX - 50) {
    // Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ²Ğ»Ñ–Ğ²Ğ¾ - Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹ ÑĞ»Ğ°Ğ¹Ğ´
    changeSlide(1);
  }
  if (touchEndX > touchStartX + 50) {
    // Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ²Ğ¿Ñ€Ğ°Ğ²Ğ¾ - Ğ¿Ğ¾Ğ¿ĞµÑ€ĞµĞ´Ğ½Ñ–Ğ¹ ÑĞ»Ğ°Ğ¹Ğ´
    changeSlide(-1);
  }
}
